// AngularFire is an officially supported AngularJS binding for Firebase.
// The bindings let you associate a Firebase URL with a model (or set of
// models), and they will be transparently kept in sync across all clients
// currently using your app. The 2-way data binding offered by AngularJS works
// as normal, except that the changes are also sent to all other clients
// instead of just a server.
//
//      AngularFire 0.2
//      http://angularfire.com
//      License: MIT
"use strict";function AngularFire(e,t,n,r){this._q=e;this._parse=t;this._timeout=n;this._initial=!0;this._remoteValue=!1;typeof r=="string"?this._fRef=new Firebase(r):this._fRef=r}angular.module("firebase",[]).value("Firebase",Firebase);angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(e,t,n){return function(r,i,s,o){var u=new AngularFire(e,t,n,r);return u.associate(i,s,o)}}]);AngularFire.prototype={associate:function(e,t,n){var r=this;n==undefined&&(n=[]);var i=this._q.defer(),s=i.promise;this._fRef.on("value",function(s){var o=!1;if(i){o=i;i=!1}r._remoteValue=n;if(s&&s.val()!=undefined){var u=s.val();if(typeof u!=typeof n){r._log("Error: type mismatch");return}var a=Object.prototype.toString;if(a.call(n)!=a.call(u)){r._log("Error: type mismatch");return}r._remoteValue=angular.copy(u);if(angular.equals(u,r._parse(t)(e)))return}r._timeout(function(){r._resolve(e,t,o,r._remoteValue)})});return s},disassociate:function(){var e=this;e._unregister&&e._unregister();this._fRef.off("value")},_resolve:function(e,t,n,r){var i=this;this._parse(t).assign(e,angular.copy(r));this._remoteValue=angular.copy(r);if(n){n.resolve(function(){i.disassociate()});this._watch(e,t)}},_watch:function(e,t){var n=this;n._unregister=e.$watch(t,function(){if(n._initial){n._initial=!1;return}var r=JSON.parse(angular.toJson(n._parse(t)(e)));if(angular.equals(r,n._remoteValue))return;n._fRef.ref().set(r)},!0)},_log:function(e){console&&console.log&&console.log(e)}};angular.module("firebase").factory("angularFireCollection",["$timeout",function(e){return function(t,n){function r(e,t){this.$ref=e.ref();this.$id=e.name();this.$index=t;angular.extend(this,{priority:e.getPriority()},e.val())}function u(e){return e?i[e]+1:0}function a(e,t){i[t.$id]=e;s.splice(e,0,t)}function f(e){var t=i[e];s.splice(t,1);i[e]=undefined}function l(e,t){s[e]=t}function c(e,t,n){s.splice(e,1);s.splice(t,0,n);h(e,t)}function h(e,t){var n=s.length;t=t||n;t>n&&(t=n);for(var r=e;r<t;r++){var o=s[r];o.$index=i[o.$id]=r}}var i={},s=[],o;typeof t=="string"?o=new Firebase(t):o=t;n&&typeof n=="function"&&o.once("value",n);o.on("child_added",function(t,n){e(function(){var e=u(n);a(e,new r(t,e));h(e)})});o.on("child_removed",function(t){e(function(){var e=t.name(),n=i[e];f(e);h(n)})});o.on("child_changed",function(t,n){e(function(){var e=i[t.name()],s=u(n),o=new r(t,e);l(e,o);s!==e&&c(e,s,o)})});o.on("child_moved",function(t,n){e(function(){var e=i[t.name()],r=u(n),o=s[e];c(e,r,o)})});s.add=function(e,t){var n;t?n=o.ref().push(e,t):n=o.ref().push(e);return n};s.remove=function(e){var t=angular.isString(e)?s[i[e]]:e;t.$ref.remove()};s.update=function(e){var t=angular.isString(e)?s[i[e]]:e,n={};angular.forEach(t,function(e,t){t.indexOf("$")!==0&&(n[t]=e)});t.$ref.set(n)};return s}}]);angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location","$route",function(e,t,n,r,i){function s(e){var t=e.split(".");if(!t instanceof Array||t.length!==3)throw new Error("Invalid JWT");var n=t[1];return JSON.parse(decodeURIComponent(escape(window.atob(n))))}function o(e,r,i,s){r&&n(function(){t(r).assign(e,i);s()})}function u(e,t,n){if(e.authRequired&&!n._authenticated){e.pathTo===undefined?n._redirectTo=r.path():n._redirectTo=e.pathTo===t?"/":e.pathTo;r.replace();r.path(t)}}return{initialize:function(t,n){var r=this;n=n||{};this._scope=e;n.scope&&(this._scope=n.scope);n.name&&(this._name=n.name);this._cb=function(){};n.callback&&typeof n.callback=="function"&&(this._cb=n.callback);this._redirectTo=null;this._authenticated=!1;if(n.path){i.current&&u(i.current,n.path,r);e.$on("$routeChangeStart",function(e,t){u(t,n.path,r)})}this._ref=new Firebase(t);if(n.simple&&n.simple===!1){o(this._scope,this._name,null);return}if(!window.FirebaseSimpleLogin){var s=new Error("FirebaseSimpleLogin undefined, did you include firebase-simple-login.js?");e.$broadcast("angularFireAuth:error",s);return}var a=new FirebaseSimpleLogin(this._ref,function(t,n){r._cb(t,n);t?e.$broadcast("angularFireAuth:error",t):n?r._loggedIn(n):r._loggedOut()});this._authClient=a},login:function(t,n){switch(t){case"github":case"persona":case"twitter":case"facebook":case"password":if(!this._authClient){var r=new Error("Simple Login not initialized");e.$broadcast("angularFireAuth:error",r)}else this._authClient.login(t,n);break;default:var i,o=this;try{i=s(t);this._ref.auth(t,function(t){t?e.$broadcast("angularFireAuth:error",t):o._loggedIn(i)})}catch(u){e.$broadcast("angularFireAuth:error",u)}}},logout:function(){if(this._authClient)this._authClient.logout();else{this._ref.unauth();this._loggedOut()}},_loggedIn:function(t){var n=this;this._authenticated=!0;o(this._scope,this._name,t,function(){e.$broadcast("angularFireAuth:login",t);if(n._redirectTo){r.replace();r.path(n._redirectTo);n._redirectTo=null}})},_loggedOut:function(){this._authenticated=!1;o(this._scope,this._name,null,function(){e.$broadcast("angularFireAuth:logout")})}}}]);var MyRecipeBoxes=angular.module("MyRecipeBoxes",["firebase"]);MyRecipeBoxes.controller("Core",["$scope","angularFireAuth",function(e,t){var n="https://myrecipeboxes.firebaseio.com/";t.initialize(n,{name:"user",path:"/home"})}]);MyRecipeBoxes.config(function(e){e.when("/",{templateUrl:"views/boxes.html",controller:"User",authRequired:!0}).when("/home",{templateUrl:"views/home.html",controller:"SignUp",authRequired:!1}).when("/login",{templateUrl:"views/login.html",controller:"User",authRequired:!1})});MyRecipeBoxes.controller("User",["$scope","angularFireCollection","angularFireAuth",function(e,t,n){}]);MyRecipeBoxes.controller("SignUp",["$scope","angularFireCollection","angularFireAuth",function(e,t,n){e.create_user=function(){n._authClient.createUser(e.user.email,e.user.password,function(e,t){if(!e){n._loggedIn(t);$location.path("/home")}})};e.validatePassword=function(){e.signup.confirm.$error.dontMatch=e.user.password!==e.user.confirm}}]);